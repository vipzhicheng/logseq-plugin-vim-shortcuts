# Logseq 插件：Vim 快捷键

[![Github All Releases](https://img.shields.io/github/downloads/vipzhicheng/logseq-plugin-vim-shortcuts/total.svg)](https://github.com/vipzhicheng/logseq-plugin-vim-shortcuts/releases)

为 Logseq 带来强大的 Vim 风格键盘绑定，提供模式化编辑、导航和命令功能，让你的笔记工作流更加高效。

[English Documentation](README.md)

![screencast](screencast.gif)

## 目录

- [功能特性](#功能特性)
- [安装](#安装)
- [快速开始](#快速开始)
- [模式说明](#模式说明)
- [设置界面](#设置界面)
- [键盘快捷键](#键盘快捷键)
- [命令模式](#命令模式)
- [标记功能](#标记功能)
- [斜杠命令](#斜杠命令)
- [使用技巧](#使用技巧)

## 功能特性

✨ **完整的 Vim 模式编辑** - 支持普通、插入、可视和命令模式
🎯 **丰富的键盘绑定** - 50+ 可自定义快捷键
⚙️ **可视化设置界面** - 图形化界面轻松配置
🔖 **标记系统** - 保存并快速跳转到常用页面和块
🎨 **块样式设置** - 背景色选择器
🔍 **智能搜索** - 支持智能大小写匹配的页内搜索
📋 **高级编辑** - 大小写转换、数字递增/递减等
🌐 **外部搜索** - 快速在 Google、GitHub、维基百科等搜索选中内容

## 安装

### 从 Logseq 市场安装

1. 打开 Logseq，进入设置 → 插件
2. 点击"市场"
3. 搜索 "Vim Shortcuts"
4. 点击"安装"

### 手动安装

1. 从 [GitHub Releases](https://github.com/vipzhicheng/logseq-plugin-vim-shortcuts/releases) 下载最新版本
2. 解压到 Logseq 插件文件夹
3. 在 Logseq 设置 → 插件中启用插件

## 快速开始

1. **安装插件** - 从 Logseq 市场安装
2. **重启 Logseq** - 激活插件
3. **聚焦任意块** - 你现在处于普通模式
4. **尝试基本导航**：`j`（下）、`k`（上）、`h`（左）、`l`（右）
5. **按 `i` 或 `a`** - 进入插入模式开始编辑
6. **按 `Cmd+j Cmd+j`（Mac）或 `Ctrl+[`** - 退出插入模式
7. **打开设置**：按 `Mod+Shift+;` 然后输入 `:help` 或点击命令面板中的齿轮图标 ⚙️

## 模式说明

### 普通模式

聚焦块但未编辑时的默认模式。可以使用导航和操作命令而不输入文本。

**如何进入**：
- 在插入模式时按 `Cmd+j Cmd+j`（Mac）或 `Ctrl+[`
- 点击编辑区域外部

### 插入模式

激活编辑模式，可以输入和修改块内容。

**如何进入**：
- 按 `i` 或 `I` - 在行首插入
- 按 `a` 或 `A` - 在行尾插入
- 按 `o` - 在下方创建新块
- 按 `O` - 在上方创建新块

### 可视模式

基于光标模式的块内字符级选择。

**如何进入**：
1. 首先通过按 `h`、`l`、`w`、`b`、`e` 或 `$` 进入光标模式
2. 按 `v` 切换可视选择模式

**可视模式中的操作**：

- `h` / `l` - 向左/向右逐字符扩展选择
- `w` - 扩展选择到下一个单词
- `b` - 扩展选择到上一个单词
- `e` - 扩展选择到单词结尾
- `$` - 扩展选择到行尾
- `v` - 退出可视模式

> **注意**：可视模式在当前块内进行字符级选择，而不是多块选择。使用光标导航键来扩展选择范围。

### 命令模式

执行高级操作的 Vim 风格命令。

**如何进入**：在普通模式按 `Mod+Shift+;` 或 `Mod+Alt+;`

**功能**：
- 自动建议和 Tab 补全
- 命令历史（上/下方向键，容量 1000 条命令）
- 30+ 可用命令（见[命令模式](#命令模式)章节）

## 键盘快捷键

所有快捷键都可以通过[设置界面](#设置界面)自定义。以下是按类别组织的默认绑定。

### 导航

| 快捷键 | 操作 | 说明 |
|--------|------|------|
| `j` | 向下移动 | 移动到下一个块（可视模式中向下扩展选择） |
| `k` | 向上移动 | 移动到上一个块（可视模式中向上扩展选择） |
| `h` | 向左移动 | 在行内向左移动光标 |
| `l` | 向右移动 | 在行内向右移动光标 |
| `w` | 下一个单词 | 跳转到下一个单词的开头 |
| `b` | 上一个单词 | 跳转到上一个单词的开头 |
| `e` | 单词结尾 | 跳转到当前单词的结尾 |
| `$` | 行尾 | 跳转到行尾 |
| `J` | 下一个同级 | 跳转到下一个同级块（可视模式中向下移动选中的块） |
| `K` | 上一个同级 | 跳转到上一个同级块（可视模式中向上移动选中的块） |
| `T` | 跳到顶部 | 滚动到页面顶部 |
| `G` | 跳到底部 | 滚动到页面底部 |
| `H` | 向外聚焦 | 移动焦点到父块 |
| `L` | 向内聚焦 | 移动焦点到子块 |
| `f<字符>` | 查找字符 | 在当前行向前查找字符 |
| `F<字符>` | 反向查找 | 在当前行向后查找字符 |
| `;` | 重复查找 | 重复上次字符查找 |
| `,` | 反向重复 | 反向重复上次字符查找 |
| `Mod+Shift+Enter` | 跳入 | 跳入页面/标签引用 |

### 编辑

| 快捷键 | 操作 | 说明 |
|--------|------|------|
| `i` / `I` | 在开头插入 | 在行首进入插入模式 |
| `a` / `A` | 在结尾插入 | 在行尾进入插入模式 |
| `o` | 下方新建块 | 在当前块下方创建新块 |
| `O` | 上方新建块 | 在当前块上方创建新块 |
| `Cmd+j Cmd+j` / `Ctrl+[` | 退出编辑 | 返回普通模式 |
| `u` | 撤销 | 撤销上次操作 |
| `Ctrl+r` | 重做 | 重做上次撤销的操作 |
| `x` | 剪切字符 | 剪切光标下的字符 |
| `X` | 剪切单词 | 剪切光标下的单词 |
| `Ctrl+a` | 增加数字 | 递增块中的第一个数字 |
| `Ctrl+x` | 减少数字 | 递减块中的第一个数字 |
| `Mod+Alt+j` | 合并下一行 | 将下一个同级块合并到当前块 |

### 块操作

| 快捷键 | 操作 | 说明 |
|--------|------|------|
| `dd` | 删除块 | 删除当前块及其子块 |
| `dj` | 删除块和下一个 | 删除当前块和下一个同级块 |
| `dk` | 删除块和上一个 | 删除当前块和上一个同级块 |
| `dc` | 更改块 | 删除内容并进入插入模式 |
| `yy` | 复制块 | 复制当前块内容 |
| `Y` | 复制块引用 | 复制块引用 |
| `p` | 在下方粘贴 | 将内容粘贴为下一个同级块 |
| `P` | 在上方粘贴 | 将内容粘贴为上一个同级块 |
| `>` / `Shift+.` | 缩进 | 增加块缩进 |
| `<` / `Shift+,` | 取消缩进 | 减少块缩进 |
| `zc` | 折叠 | 折叠当前块 |
| `zo` | 展开 | 展开当前块 |
| `zC` | 全部折叠 | 折叠当前块及所有子块 |
| `zO` | 全部展开 | 展开当前块及所有子块 |

### 大小写转换

| 快捷键 | 操作 | 说明 |
|--------|------|------|
| `Mod+Shift+u` | 切换大小写 | 在大写和小写之间切换 |
| `gu` | 小写 | 转换为小写 |
| `gU` | 大写 | 转换为大写 |
| `数字`+`Mod+Shift+u` | 大小写样式 | 应用特定大小写样式（1-16，见[大小写样式](#大小写转换样式)） |

### 搜索

| 快捷键 | 操作 | 说明 |
|--------|------|------|
| `/` | 页内搜索 | 打开页内搜索（智能大小写匹配） |
| `n` | 下一个结果 | 跳转到下一个搜索结果 |
| `N` | 上一个结果 | 跳转到上一个搜索结果 |
| `sq` | 清除高亮 | 移除搜索高亮 |
| `sg` | 搜索 Google | 在 Google 搜索块内容 |
| `sh` | 搜索 GitHub | 在 GitHub 搜索块内容 |
| `ss` | 搜索 Stack Overflow | 在 Stack Overflow 搜索块内容 |
| `sb` | 搜索百度 | 在百度搜索块内容 |
| `se` | 搜索维基百科 | 在维基百科搜索块内容 |
| `sy` | 搜索 YouTube | 在 YouTube 搜索块内容 |

### 标记

| 快捷键 | 操作 | 说明 |
|--------|------|------|
| `<数字>m` | 保存块标记 | 将当前块保存为标记（数字） |
| `<数字>M` | 保存页面标记 | 将当前页面保存为标记（数字） |
| `<数字>'` | 跳转到块标记 | 在主区域跳转到块标记（数字） |
| `<数字>Shift+'` | 跳转到页面标记 | 在主区域跳转到页面标记（数字） |
| `<数字>Mod+'` | 跳转到块标记（侧边栏） | 在右侧边栏打开块标记（数字） |
| `<数字>Mod+Shift+'` | 跳转到页面标记（侧边栏） | 在右侧边栏打开页面标记（数字） |

### 可视模式和其他

| 快捷键 | 操作 | 说明 |
|--------|------|------|
| `v` | 切换可视模式 | 进入/退出可视块选择模式 |
| `Mod+Shift+;` / `Mod+Alt+;` | 命令模式 | 打开命令面板 |
| `Mod+/` | 表情选择器 | 打开表情选择器界面 |

> **注意**：`Mod` = macOS 上的 `Cmd`，Windows/Linux 上的 `Ctrl`

> **组合操作**：许多快捷键支持数字前缀（例如 `5j` 向下移动 5 个块，`3dd` 删除 3 个块）

## 设置界面

插件包含现代化的图形界面，无需编辑配置文件即可自定义所有键盘绑定。

### 打开设置

**方法 1**：点击命令面板中的**齿轮图标（⚙）**（位于运行和关闭按钮之间）
**方法 2**：按 `Mod+Shift+;` 打开命令模式，然后输入 `:help`

### 功能特性

- ✅ **可视化配置**：在清晰的分类界面中查看和修改所有键盘绑定
- ✅ **多重绑定**：为同一操作分配多个键组合
- ✅ **开关控制**：快速启用或禁用单个快捷键
- ✅ **验证功能**：自动格式验证和重复检测
- ✅ **一键重置**：轻松恢复任何操作的默认绑定
- ✅ **内置帮助**：通过帮助按钮访问完整文档

### 使用方法

1. **打开设置**：点击命令面板中的齿轮图标（⚙）
2. **浏览分类**：浏览导航、编辑、块操作、搜索、标记、可视模式和命令分类
3. **启用/禁用**：使用复选框切换快捷键开关
4. **编辑绑定**：点击"编辑"修改键盘绑定，按 Enter 保存，Esc 取消
5. **添加替代绑定**：点击"+ 添加键盘绑定"为同一操作添加额外的快捷键
6. **移除绑定**：点击"移除"删除绑定（至少保留一个）
7. **重置为默认**：点击"重置为默认"恢复原始设置
8. **保存更改**：点击"保存设置" - Logseq 会提示重启以使更改生效

### 键盘绑定格式

键盘绑定支持三种格式：

| 格式 | 示例 | 说明 |
|------|------|------|
| **单键** | `j`, `k`, `h`, `l` | 单个字符键 |
| **组合键** | `shift+j`, `ctrl+r`, `mod+shift+a` | 修饰键 + 普通键 |
| **连续键** | `g u`, `d d`, `z c` | 按顺序按下多个键 |

**修饰键**：
- `mod` - macOS 上的 Cmd (⌘)，Windows/Linux 上的 Ctrl
- `shift` - Shift 键
- `ctrl` - Control 键
- `alt` - Alt 键（macOS 上的 Option）

### 重要提示

- ⚠️ 更改需要**重启 Logseq** 才能生效
- ⚠️ 重复检测可防止绑定冲突
- ⚠️ 每个操作至少保留一个绑定
- ✅ 设置在 Logseq 配置中持久保存

## 命令模式

执行强大的 Vim 风格命令进行高级操作。按 `Mod+Shift+;` 或 `Mod+Alt+;` 激活。

### 命令面板功能

- **自动补全**：输入时提供预输入建议
- **Tab 补全**：当只有一个匹配项时按 Tab 立即补全
- **命令历史**：使用上/下方向键浏览最近 1000 条命令
- **键盘导航**：
  - `Esc` - 关闭命令模式并返回编辑
  - `Enter` - 执行命令
  - `Tab` - 自动补全
- **界面控制**：运行按钮和关闭按钮作为替代方案

### 可用命令

#### 导航和跳转

| 命令 | 说明 | 示例 |
|------|------|------|
| `:数字` | 滚动到第 N 行 | `:25` - 跳转到第 25 行 |
| `:-数字` | 从末尾滚动到第 N 行 | `:-5` - 跳转到倒数第 5 行 |
| `:.数字` | 滚动到百分比位置 | `:.50` - 跳转到页面 50% 处 |
| `:go <页面>` | 导航到现有页面/块 | `:go 2022-02-22`<br>`:go ((块-uuid))` |
| `:go! <页面>` | 导航或创建页面 | `:go! 项目想法` - 不存在则创建 |
| `:go @index` | 转到目录页 | `:go @` 也可以 |
| `:go @today` | 转到今天的日志 | |
| `:go @yesterday` | 转到昨天的日志 | |
| `:go @tomorrow` | 转到明天的日志 | |
| `:go @prev` | 转到前一天的日志 | |
| `:go @next` | 转到后一天的日志 | |
| `:go @back` | 在历史中后退 | |
| `:go @forward` | 在历史中前进 | |
| `:go[!] <名称> --ns` | 转到/创建命名空间页面 | 在 `test` 页面：`:go! sub --ns` → `test/sub` |
| `:m <数字>` | 跳转到标记 | `:m 3` - 跳转到标记 3 |
| `:mark <数字>` | `:m` 的别名 | `:mark 5` |

#### 文本操作

| 命令 | 说明 | 示例 |
|------|------|------|
| `:s/模式/替换/标志` | 在当前块中替换（正则） | `:s/foo/bar/gi` - 替换所有 foo 为 bar（不区分大小写） |
| `:%s/模式/替换/标志` | 在所有页面块中替换（正则） | `:%s/TODO/DONE/g` - 替换所有 TODO 为 DONE |
| `:substitute/` | `:s/` 的别名 | `:substitute/old/new/` |
| `:%substitute/` | `:%s/` 的别名 | `:%substitute/old/new/g` |

#### 标记管理

| 命令 | 说明 | 示例 |
|------|------|------|
| `:marks` | 显示所有保存的标记 | 显示带注释的标记 |
| `:delm <数字>` | 删除特定标记 | `:delm 1 2 3` - 删除标记 1、2 和 3 |
| `:delmarks <数字>` | `:delm` 的别名 | `:delmarks 5 6` |
| `:delm!` | 删除所有标记 | 清除所有保存的标记 |
| `:delmarks!` | `:delm!` 的别名 | |

#### 页面管理

| 命令 | 说明 | 示例 |
|------|------|------|
| `:re <新名称>` | 重命名当前页面 | `:re 新页面名` - 如果目标存在则合并 |
| `:rename <新名称>` | `:re` 的别名 | `:rename 项目笔记` |
| `:copy-path` | 复制页面/日志文件路径 | 用于外部编辑 |
| `:open-in-vscode` | 在 VSCode 中打开当前页面 | 需要安装 VSCode |

#### 内容生成

| 命令 | 说明 | 示例 |
|------|------|------|
| `:lorem` | 生成随机 lorem ipsum 块 | `:lorem` - 默认段落 |
| `:lorem-ipsum` | `:lorem` 的别名 | |
| `:lorem -u w` | 生成随机单词 | 单位：`w`/`word`、`s`/`sentence`、`p`/`paragraph` |
| `:lorem --unit sentence` | 长格式单位指定 | `:lorem --unit paragraph` |
| `:emoji <关键词>` | 通过关键词搜索插入表情 | `:emoji smile` |
| `:emoji <关键词> <数量>` | 插入多个表情 | `:emoji heart 5` - 插入 5 个心形 |
| `:emoji-picker` | 打开表情选择器界面 | 可视化表情选择 |

#### 块样式

| 命令 | 说明 | 示例 |
|------|------|------|
| `:bg <颜色>` | 设置块背景色 | `:bg red` 或 `:bg #ff0000` |
| `:bg-picker` | 打开颜色选择器界面 | 可视化颜色选择 |
| `:bg-random` | 设置随机背景色 | 随机颜色分配 |
| `:bg-clear` | 移除背景色 | 清除块样式 |

**颜色格式**：命名颜色（如 `red`、`blue`）来自 [CSS 颜色值](https://developer.mozilla.org/zh-CN/docs/Web/CSS/color_value)或十六进制代码（如 `#ff0000`）

> 注意：块样式命令支持可视模式中的多块选择

#### 排序

| 命令 | 说明 |
|------|------|
| `:sort` | 按字母顺序排序块（A-Z） |
| `:rsort` | 反向排序块（Z-A） |

- **未聚焦块**：排序页面的顶级块
- **聚焦块**：排序该块的子块

#### 编辑

| 命令 | 说明 |
|------|------|
| `:undo` | 撤销上次编辑 |
| `:redo` | 重做上次撤销的编辑 |

#### 系统

| 命令 | 说明 |
|------|------|
| `:w` / `:write` | 保存页面（象征性的，Logseq 自动保存） |
| `:wq` | 保存并退出命令模式 |
| `:q` / `:quit` | 退出命令模式 |
| `:h` / `:help` | 显示帮助文档 |

## 大小写转换样式

使用 `数字` + `Mod+Shift+u` 应用不同的大小写转换：

| 数字 | 样式 | 输出示例 |
|------|------|----------|
| `1` | 切换大小写（默认） | 在大写和小写之间切换 |
| `2` | 大写 | `LOGSEQ IS SO AWESOME` |
| `3` | 小写 | `logseq is so awesome` |
| `4` | 标题大小写 | `Logseq Is So Awesome` |
| `5` | 句子大小写 | `Logseq is so awesome` |
| `6` | 路径大小写 | `logseq/is/so/awesome` |
| `7` | 首字母大写 | `Logseq Is So Awesome` |
| `8` | 常量大小写 | `LOGSEQ_IS_SO_AWESOME` |
| `9` | 点分隔 | `logseq.is.so.awesome` |
| `10` | 标题分隔 | `Logseq-Is-So-Awesome` |
| `11` | 参数大小写 | `logseq-is-so-awesome` |
| `12` | 帕斯卡命名 | `LogseqIsSoAwesome` |
| `13` | 驼峰命名 | `logseqIsSoAwesome` |
| `14` | 蛇形命名 | `logseq_is_so_awesome` |
| `15` | 交换大小写 | `lOGSEQ IS SO AWESOME` |
| `16` | 随机大小写 | `logsEQ IS SO awESoME` |

**用法**：先按数字，然后按 `Mod+Shift+u`。例如：按 `2` 然后 `Mod+Shift+u` 转换为大写。

## 标记功能

标记系统让你可以为常用的页面和块添加书签并快速跳转 - 就像浏览器书签一样，但用于你的知识图谱。

### 功能特性

- 🔖 **持久化存储**：标记按图谱自动保存
- 📄 **双重类型**：保存块级和页面级标记
- 🔢 **无限标记**：使用任意数字（不限于 0-9）
- 📝 **自动注释**：块标记显示内容预览，页面标记显示页面名称
- 🎯 **多种跳转模式**：在主区域或右侧边栏打开

### 用法

1. **保存标记**：
   - 块标记：按 `m` 然后按数字（例如 `m5` 保存到标记 5）
   - 页面标记：按 `M` 然后按数字（例如 `M3` 将页面保存到标记 3）

2. **跳转到标记**：
   - 主区域：按 `'` 然后按数字（例如 `'5` 跳转到标记 5）
   - 右侧边栏：按 `Mod+'` 然后按数字（例如 `Mod+'5` 在侧边栏打开标记 5）

3. **查看所有标记**：在命令模式输入 `:marks`

4. **删除标记**：
   - 特定标记：`:delm 1 2 3`
   - 所有标记：`:delm!`

### 对比

| 功能 | 标记 | 收藏夹 | 最近 | Tabs 插件 |
|------|------|--------|------|-----------|
| 自定义组织 | ✅ | ✅ | ❌ | ✅ |
| 基于数字的快速访问 | ✅ | ❌ | ❌ | ❌ |
| 块级书签 | ✅ | ❌ | ❌ | ❌ |
| 纯键盘工作流 | ✅ | ❌ | ❌ | ⚠️ |

> **注意**：`m` 快捷键可能与 Markmap 插件冲突。如果遇到问题，请更新 Markmap 到最新版本或在设置中重新映射标记快捷键。

## 斜杠命令

插件在 Logseq 的斜杠命令菜单中添加了 Vim 相关的操作：

| 斜杠命令 | 说明 |
|----------|------|
| `/Insert Emoji` | 在光标位置插入表情 |
| `/Sort Blocks` | 按字母顺序排序子块（A-Z） |
| `/Reverse Sort Blocks` | 按字母反序排序子块（Z-A） |
| `/Random Bg Color` | 为当前块应用随机背景色 |
| `/Children Random Bg Color` | 为所有子块应用随机背景色 |

## 使用技巧

### 一般说明

- **不是纯 Vim**：本插件模仿 Vim 行为，但不是完整的 Vim 实现
- **剪贴板范围**：复制/粘贴操作（`yy`、`p`）使用 Logseq 的内部剪贴板，而非系统剪贴板。使用系统剪贴板请用 `Cmd+C`/`Cmd+V`
- **自动保存**：`:w`（写入）命令是象征性的 - Logseq 自动保存所有更改
- **数字前缀**：许多命令支持重复 - 例如 `5j` 向下移动 5 个块，`3dd` 删除 3 个块

### 智能搜索

按 `/` 触发智能大小写匹配的页内搜索：
- **小写查询**：不区分大小写搜索（例如 `vim` 匹配 "Vim"、"VIM"、"vim"）
- **混合大小写查询**：区分大小写搜索（例如 `Vim` 只匹配 "Vim"）

### 键盘绑定说明

- **自定义**：所有键盘绑定都可以通过设置界面自定义
- **多重绑定**：操作可以有多个键组合
- **潜在冲突**：某些快捷键可能与未来的 Logseq 更新或其他插件冲突
- **平台差异**：`Mod` = macOS 上的 `Cmd`，Windows/Linux 上的 `Ctrl`

### 限制

- **日志首页**：由于 API 限制，在日志首页时某些快捷键会重定向到特定页面
- **合并块**：合并命令仅适用于没有子块的同级块；避免在编辑模式下快速触发
- **滚动到顶部**：Vim 的 `gg` 被 Logseq 用于转到图谱视图。请使用 `T`（Shift+t），或重新映射 Logseq 的 `gg` 并配置此插件使用它

### 组合操作

在操作前添加数字前缀以重复：
- `5j` - 向下移动 5 个块
- `3dd` - 删除 3 个块
- `10k` - 向上移动 10 个块
- `2o` - 在下方创建 2 个新块

### 跳入页面

当光标在页面引用 `[[页面名称]]` 或标签 `#标签` 上时：
- 按 `Mod+Shift+Enter` 跳入该页面
- 使用数字前缀：`2 Mod+Shift+Enter` 如果存在多个链接则跳转到第 2 个页面链接

## 贡献

欢迎贡献！请随时在 [GitHub](https://github.com/vipzhicheng/logseq-plugin-vim-shortcuts) 上提交问题、功能请求或拉取请求。

## 支持项目

如果这个插件改善了你的 Logseq 工作流，请考虑支持开发：

- ☕ [Buy Me a Coffee](https://www.buymeacoffee.com/vipzhicheng)
- 🎁 [爱发电（中国用户）](https://afdian.net/@vipzhicheng)

你的支持有助于维护和改进这个插件！

## 更新日志

查看 [CHANGELOG.md](CHANGELOG.md) 了解版本历史和更新。

## 许可证

MIT 许可证 - 详见 [LICENSE](LICENSE) 文件。

## 致谢

- 受 Vim 的模式编辑范式启发
- 为出色的 [Logseq](https://logseq.com/) 社区打造
- 感谢所有贡献者和用户的反馈和支持

---

**用 ❤️ 为 Vim 和 Logseq 爱好者打造**
